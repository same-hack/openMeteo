<!-- app.html -->
<style>
  /* ========= ポップアップ（外枠の見た目をここで作る：二重化しない） ========= */
  .dark-popup .leaflet-popup-content-wrapper {
    background: rgba(34, 34, 34, 0.92) !important;
    color: #fff !important;
    border-radius: 10px !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35) !important;
  }

  .dark-popup .leaflet-popup-content {
    margin: 12px 14px !important; /* 左上カードと同じ余白感 */
    color: #fff !important;
    font:
      14px system-ui,
      -apple-system,
      Segoe UI,
      Roboto,
      sans-serif;
  }

  .dark-popup .leaflet-popup-tip {
    background: rgba(34, 34, 34, 0.92) !important;
  }

  .dark-popup a.leaflet-popup-close-button {
    color: rgba(255, 255, 255, 0.85) !important;
    margin-top: 2px;
    margin-right: 2px;
  }

  .dark-popup a.leaflet-popup-close-button:hover {
    color: #fff !important;
  }

  /* ========= トグル（ラベル＋スイッチのみ / ON OFF文字なし） ========= */
  .toggle {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    user-select: none;
  }

  .toggle-label {
    font-size: 12px;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.92);
  }

  .toggle-track {
    width: 44px;
    height: 24px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.08);
    position: relative;
    transition:
      background 120ms ease,
      border-color 120ms ease;
    box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.15);
  }

  .toggle-thumb {
    width: 18px;
    height: 18px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.92);
    position: absolute;
    top: 50%;
    left: 3px;
    transform: translateY(-50%);
    transition: left 140ms ease;
    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
  }

  .toggle.on .toggle-track {
    background: rgba(255, 255, 255, 0.18);
    border-color: rgba(255, 255, 255, 0.28);
  }

  .toggle.on .toggle-thumb {
    left: 23px;
  }
</style>

<div id="map" style="height: 100vh; width: 100%"></div>

<div
  style="
    position: fixed;
    left: 12px;
    top: 12px;
    z-index: 9999;
    background: rgba(34, 34, 34, 0.92);
    color: #fff;
    padding: 12px 14px;
    border-radius: 10px;
    font:
      14px system-ui,
      -apple-system,
      Segoe UI,
      Roboto,
      sans-serif;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
    min-width: 260px;
  "
>
  <div
    style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px"
  >
    <div style="font-weight: 700">中心の天気</div>

    <div style="display: flex; align-items: center; gap: 10px">
      <!-- 全国：ラベル＋トグル（ON/OFF表示なし） -->
      <div
        class="toggle"
        [class.on]="showNationwide"
        (click)="toggleNationwide()"
        title="全国表示のON/OFF"
      >
        <div class="toggle-label">全国</div>
        <div class="toggle-track">
          <div class="toggle-thumb"></div>
        </div>
      </div>

      <!-- 開閉（＋ / ー） -->
      <button
        (click)="panelClosed = !panelClosed"
        style="
          width: 30px;
          height: 30px;
          border-radius: 8px;
          border: 1px solid rgba(255, 255, 255, 0.18);
          background: rgba(255, 255, 255, 0.06);
          color: #fff;
          cursor: pointer;
          font-weight: 800;
          line-height: 28px;
        "
        title="開閉"
      >
        {{ panelClosed ? '＋' : 'ー' }}
      </button>
    </div>
  </div>

  @if (!panelClosed) {
    @if (centerLoading) {
      <div>取得中…</div>
    }

    @if (centerError) {
      <div style="color: #ff6b6b">{{ centerError }}</div>
    }

    @if (centerWeather) {
      <div><strong>天気:</strong> {{ centerWeatherText }}</div>
      <div>
        <strong>気温:</strong> {{ centerWeather.current?.temperature_2m }}
        {{ centerWeather.current_units?.temperature_2m ?? '°C' }}
      </div>
      <div>
        <strong>風速:</strong> {{ centerWeather.current?.wind_speed_10m }}
        {{ centerWeather.current_units?.wind_speed_10m ?? 'km/h' }}
      </div>

      <div style="margin-top: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7)">
        {{ centerWeather.current?.time | date: 'yyyy/MM/dd HH:mm' }}
      </div>
      <div style="margin-top: 4px; font-size: 12px; color: rgba(255, 255, 255, 0.62)">
        座標: {{ centerWeather.latitude.toFixed(5) }}, {{ centerWeather.longitude.toFixed(5) }}
      </div>

      <div style="margin-top: 6px; font-size: 12px; color: rgba(255, 255, 255, 0.45)">
        zoom: {{ currentZoom }}
      </div>
    }
  }
</div>
